"use strict";(()=>{var e={};e.id=398,e.ids=[398],e.modules={67096:e=>{e.exports=require("bcrypt")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},60738:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>E,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{DELETE:()=>g,GET:()=>h,POST:()=>d});var o=r(49303),n=r(88716),a=r(60670),i=r(87070),l=r(20728),c=r(67096),u=r.n(c),p=r(30180);async function d(e){try{let t=e.headers.get("content-type")||"",r={},s=null;if(t.includes("multipart/form-data")){let t=await e.formData();r=Object.fromEntries(t.entries());let o=t.get("logo");if(o&&o.size>0){let e=Buffer.from(await o.arrayBuffer()),t=`${Date.now()}-${o.name}`;s=await (0,p.O)(e,t,o.type||"image/png","school-logos")}}else r=await e.json();let{name:o,email:n,password:a,address:c,principal_name:d,location:h,school_address:g}=r;if(!o||!n||!a)return i.NextResponse.json({error:"Missing required fields"},{status:400});if(await l.Z.schools.findUnique({where:{email:n}}))return i.NextResponse.json({error:"School with this email already exists"},{status:400});let m=await u().hash(a,10),f=await l.Z.schools.create({data:{name:o,email:n,password:m,logo:s,address:c||null,principal_name:d||null,location:h||null,school_address:g||null,updatedAt:new Date}});return i.NextResponse.json(f)}catch(e){return console.error("Error registering school:",e),i.NextResponse.json({error:"Error registering school"},{status:500})}}async function h(){try{let e=await l.Z.schools.findMany({select:{id:!0,name:!0,email:!0,isActive:!0,createdAt:!0,updatedAt:!0,logo:!0,address:!0,principal_name:!0,location:!0,school_address:!0,_count:{select:{teachers:!0}}}});return i.NextResponse.json(e)}catch(e){return console.error("Error fetching schools:",e),i.NextResponse.json({error:"Error fetching schools"},{status:500})}}async function g(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"School ID is required"},{status:400});return await l.Z.schools.delete({where:{id:parseInt(r)}}),i.NextResponse.json({message:"School deleted successfully"})}catch(e){return console.error("Error deleting school:",e),i.NextResponse.json({error:"Error deleting school"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/school-registration/route",pathname:"/api/school-registration",filename:"route",bundlePath:"app/api/school-registration/route"},resolvedPagePath:"C:\\internships\\devbumi sportal foundation\\content-manneger\\src\\app\\api\\school-registration\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:E}=m,y="/api/school-registration/route";function x(){return(0,a.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:w})}},20728:(e,t,r)=>{r.d(t,{Z:()=>o});let s=require("@prisma/client"),o=globalThis.prisma??new s.PrismaClient},30180:(e,t,r)=>{r.d(t,{O:()=>n});let s=require("@aws-sdk/client-s3"),o=new s.S3Client({region:process.env.AWS_REGION,credentials:{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY}});async function n(e,t,r="application/pdf",n="lessons"){let a=new s.PutObjectCommand({Bucket:process.env.S3_BUCKET_NAME,Key:`${n}/${t}`,Body:e,ContentType:r});return await o.send(a),`https://${process.env.S3_BUCKET_NAME}.s3.${process.env.AWS_REGION}.amazonaws.com/${n}/${t}`}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(60738));module.exports=s})();